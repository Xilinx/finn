node {
    def app
    stage('Clone repository') {
        /* Let's make sure we have the repository cloned to our workspace */
        checkout scm
    }
    withEnv([
        "FINN_XILINX_PATH=/proj/xbuilds/2022.1_released/installs/lin64",
        "FINN_XILINX_VERSION=2022.1",
        "FINN_DOCKER_TAG=xilinx/finn:jenkins"
    ]){
        parallel firstBranch: {
            stage('Run brevitas export tests') {
                dir("${env.WORKSPACE}") {
                sh("bash run-docker.sh python setup.py test --addopts -mbrevitas_export")
                }
            }
        }
    }
}
